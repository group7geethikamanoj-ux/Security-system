<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Log Records</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/theme.js" defer></script>
</head>

<body>

<div class="navbar">
    <div class="nav-left">
        <div class="breadcrumb">
            <a href="/dashboard">Dashboard</a>
            <span>&gt;</span>
            <span>Logs</span>
        </div>
    </div>

    <div class="nav-right">
        <a href="javascript:void(0)" class="logout" onclick="confirmLogout()">Logout</a>
    </div>
</div>

<div class="container">

    <!-- SYSTEM STATUS BAR -->
    <div class="system-status">
        <span>Dashboard: ONLINE</span>
        <span id="lastSync"></span>
    </div>

    <h1>Logbook Records</h1>

    <!-- SEARCH BAR -->
    <div class="search-bar">
        <input type="text" id="nameSearch" placeholder="Search by name..." onkeyup="filterTable()">
        <input type="text" id="dateSearch" placeholder="Search by date..." onkeyup="filterTable()">
    </div>

    {% if logs and logs|length > 0 %}

    <div class="table-wrapper">
    <table id="logTable">

        <thead>
            <tr>
                <th>Name</th>
                <th>Designation</th>
                <th>Blacklist</th>
                <th>Alcohol</th>
                <th>Mobile</th>
                <th>Face</th>
                <th>Status</th>
                <th>Timestamp</th>
            </tr>
        </thead>

        <tbody>
        {% for log in logs %}
            <tr>
                <td>{{ log.get('name','') }}</td>
                <td>{{ log.get('designation','') }}</td>
                <td>{{ log.get('blacklist_status','') }}</td>
                <td>{{ log.get('alcohol','') }}</td>
                <td>{{ log.get('mobile','') }}</td>
                <td>{{ log.get('face_status','') }}</td>

                <td>
                   {% if log.final_status == "DENIED" %}
                   <span class="badge danger">DENIED</span>
                   {% else %}
                   <span class="badge success">ALLOWED</span>
                   {% endif %}

                </td>

                <td>{{ log.get('timestamp','') }}</td>
            </tr>
        {% endfor %}
        </tbody>

    </table>
    </div>

    {% else %}
        <p>No records found.</p>
    {% endif %}
</div>

<!-- SYSTEM STATUS CLOCK -->
<script>
function updateDashboardTime() {
    const now = new Date();
    document.getElementById("lastSync").textContent =
        "Time: " + now.toLocaleTimeString();
}

updateDashboardTime();
setInterval(updateDashboardTime, 1000);
</script>


<!-- TABLE FILTER SCRIPT -->
<script>
function filterTable() {
    let nameInput = document.getElementById("nameSearch").value.toLowerCase();
    let dateInput = document.getElementById("dateSearch").value.toLowerCase();

    let table = document.getElementById("logTable");
    let rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) {
        let nameCol = rows[i].cells[0].textContent.toLowerCase();
        let dateCol = rows[i].cells[7].textContent.toLowerCase();

        if (nameCol.includes(nameInput) && dateCol.includes(dateInput)) {
            rows[i].style.display = "";
        } else {
            rows[i].style.display = "none";
        }
    }
}
</script>

</body>
</html>
